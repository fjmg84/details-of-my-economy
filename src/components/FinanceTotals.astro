<!-- Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <div class="bg-white rounded-xl border border-gray-200 p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-10 h-10 bg-green-100 rounded-lg"></div>
      <div>
        <p class="text-sm font-medium text-gray-600">Ingresos Totales</p>
      </div>
    </div>
    <p id="totalIncome" class="text-[28px] font-bold text-gray-900">$0.00</p>
    <p class="text-xs font-medium text-green-600 mt-2">
      +12.5% vs mes anterior
    </p>
  </div>

  <div class="bg-white rounded-xl border border-gray-200 p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-10 h-10 bg-red-100 rounded-lg"></div>
      <div>
        <p class="text-sm font-medium text-gray-600">Gastos Totales</p>
      </div>
    </div>
    <p id="totalExpense" class="text-[28px] font-bold text-gray-900">$0.00</p>
    <p class="text-xs font-medium text-red-600 mt-2">+8.2% vs mes anterior</p>
  </div>

  <div class="bg-white rounded-xl border border-gray-200 p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-10 h-10 bg-blue-100 rounded-lg"></div>
      <div>
        <p class="text-sm font-medium text-gray-600">Balance Neto</p>
      </div>
    </div>
    <p id="balance" class="text-[28px] font-bold text-gray-900">$0.00</p>
    <p class="text-xs font-medium text-green-600 mt-2">
      +22.4% vs mes anterior
    </p>
  </div>
</div>

<script>
  // Calculate summary
  import { calculateSummary } from "../utils/lib";
  import { formatCurrency } from "../utils/lib";
  import type { Transaction } from "../types/finance";
  import { getTransactions } from "../utils/storage";
  import { EVENT_NAME } from "src/utils/config";

  // Update summary cards
  const updateSummary = (transactions: Transaction[]) => {
    const summary = calculateSummary(transactions);
    const totalIncomeEl = document.querySelectorAll("#totalIncome");
    const totalExpenseEl = document.querySelectorAll("#totalExpense");
    const balanceEl = document.querySelectorAll("#balance");

    if (totalIncomeEl)
      totalIncomeEl.forEach((el) => {
        el.textContent = formatCurrency(summary.income);
      });

    if (totalExpenseEl)
      totalExpenseEl.forEach((el) => {
        el.textContent = formatCurrency(summary.expense);
      });

    if (balanceEl)
      balanceEl.forEach((el) => {
        el.textContent = formatCurrency(summary.balance);
      });
  };

  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth() + 1;

  const filterTransactionsByMonth = (transactions: Transaction[]) => {
    if (transactions.length === 0) return [];

    return transactions.filter((t) => {
      const createdAt = new Date(t.createdAt);
      return (
        createdAt.getFullYear() === year && createdAt.getMonth() + 1 === month
      );
    });
  };

  window.addEventListener("DOMContentLoaded", () => {
    const transactions = getTransactions();
    const filteredTransactions = filterTransactionsByMonth(transactions);
    updateSummary(filteredTransactions);
  });

  window.addEventListener(EVENT_NAME.TRANSACTIONS_UPDATED, () => {
    const transactions = getTransactions();
    const filteredTransactions = filterTransactionsByMonth(transactions);

    updateSummary(filteredTransactions);
  });
</script>

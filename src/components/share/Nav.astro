---
import AssistantIcon from "@components/Icons/AssistantIcon.astro";
import ChartIcon from "@components/Icons/ChartIcon.astro";
import ExpenseIcon from "@components/Icons/ExpenseIcon.astro";
import IncomeIcon from "@components/Icons/IncomeIcon.astro";
import AddIcon from "@components/Icons/AddIcon.astro";
import IconComponent from "@components/Icons/IconComponent.astro";

const { pathname } = Astro.url;
import { ROUTES } from "@utils/routes";
---

<nav class="flex flex-col gap-2">
  <a
    href={ROUTES.DASHBOARD}
    class={pathname === ROUTES.DASHBOARD
      ? "flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-900 font-semibold transition-colors"
      : "flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}
  >
    <IconComponent color="currentColor" sizeX="20" sizeY="20">
      <AddIcon />asdasd
    </IconComponent>

    <span class="text-sm">Dashboard</span>
  </a>
  <a
    href={ROUTES.INGRESOS}
    class={pathname === ROUTES.INGRESOS
      ? "flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-900 font-semibold transition-colors"
      : "flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}
  >
    <IconComponent color="currentColor" sizeX="20" sizeY="20">
      <IncomeIcon />
    </IconComponent>
    <span class="text-sm">Ingresos</span>
  </a>
  <a
    href={ROUTES.GASTOS}
    class={pathname === ROUTES.GASTOS
      ? "flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-900 font-semibold transition-colors"
      : "flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}
  >
    <IconComponent color="currentColor" sizeX="20" sizeY="20">
      <ExpenseIcon />
    </IconComponent>
    <span class="text-sm">Gastos</span>
  </a>
  <a
    href={ROUTES.GRAFICOS}
    class={pathname === ROUTES.GRAFICOS
      ? "flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-900 font-semibold transition-colors"
      : "flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}
  >
    <IconComponent color="currentColor" sizeX="20" sizeY="20">
      <ChartIcon />
    </IconComponent>
    <span class="text-sm">Gr√°ficos</span>
  </a>
  <a
    href={ROUTES.ASISTENTE}
    class={pathname === ROUTES.ASISTENTE
      ? "flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-900 font-semibold transition-colors"
      : "flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}
  >
    <IconComponent color="currentColor" sizeX="20" sizeY="20">
      <AssistantIcon />
    </IconComponent>
    <span class="text-sm">Asistente</span>
  </a>
</nav>

<script>
  import { getTransactions } from "src/utils/storage";
  import { getTransactionsToday } from "src/utils/lib";
  import { EVENT_NAME } from "src/utils/config";

  const getTransactionsTodayCount = () => {
    const transactions = getTransactions();
    const transactionsToday = getTransactionsToday(transactions);
    const expenses =
      transactionsToday.filter((t) => t.type === "expense") || [];
    const income = transactionsToday.filter((t) => t.type === "income") || [];

    const incomeCount = document.querySelectorAll("#incomeCount");
    const expenseCount = document.querySelectorAll("#expenseCount");

    if (incomeCount) {
      incomeCount.forEach((count) => {
        count.textContent = income.length.toString();
      });
    }

    if (expenseCount) {
      expenseCount.forEach((count) => {
        count.textContent = expenses.length.toString();
      });
    }
  };

  window.addEventListener(EVENT_NAME.TRANSACTIONS_UPDATED, () => {
    getTransactionsTodayCount();
  });

  getTransactionsTodayCount();
</script>
